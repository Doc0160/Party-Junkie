
	<!DOCTYPE html>
	<html name="html">
	<head>
		<title>PJ-010-ouvrir la fenetre</title>
		<link rel="icon" type="image/png" href="../img/favicon.png" />
		<link rel="alternate" type="application/atom+xml" title="Atom" href="../atom.xml" />
		<link rel="stylesheet" type="text/css" href="../css/style.css">
		<link rel="stylesheet" type="text/css" href="../css/code.css">
		<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
		<script type="text/javascript" src="../js/script_menu.js"></script>
		<script type="text/javascript" src="https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js?skin=sunburst"></script>
	</head>
    <!--December 18 2016 08:41:38.-->
    <body name="body">

	<div id="menu">
		<ul><li><a href="000.html"><span class="numbers">000</span> - presentation</a></li><li><a href="001.html"><span class="numbers">001</span> - introduction</a></li><li><a href="002.html"><span class="numbers">002</span> - premisse</a></li><li><a href="003.html"><span class="numbers">003</span> - les pointeurs</a></li><li><a href="004.html"><span class="numbers">004</span> - enum union struct</a></li><li><a href="005.html"><span class="numbers">005</span> - preprocesseur</a></li><li><a href="006.html"><span class="numbers">006</span> - binaire</a></li><li><a href="007.html"><span class="numbers">007</span> - visual studio et winapi</a></li><li><a href="008.html"><span class="numbers">008</span> - mise en place d'un projet</a></li><li><a href="009.html"><span class="numbers">009</span> - et la lumiere fut</a></li><li><a href="010.html"><span class="numbers">010</span> - ouvrir la fenetre</a></li><li><a href="999.html"><span class="numbers">999</span> - des trucs</a></li>
</ul>

	<div id="menu_btn">
		<img class="btn" src="../img/menu.svg">
	</div>
</div>
<div class="animation">
	<div class="mario"></div>
	<div class="cloud"></div>
	<div class="mountain1" id="mountain0"></div>
	<div class="mountain2" id="mountain1"></div>
	<div class="mountain1" id="mountain2"></div>
</div>
<div class="content" id="content">
<article id="a0">
<h1>Ouvrir une fenétre: la bureaucratie française</h1>
    <p>
      Pour pouvoir ouvrir une fenétre, il faut d'abord l'"enregistrer" avec
      <a href="https://msdn.microsoft.com/fr-fr/library/windows/desktop/ms633586(v=vs.85).aspx">RegisterClass</a>.<br/>
      RegisterClass demande de remplir une structure
      <a href="https://msdn.microsoft.com/fr-fr/library/windows/desktop/ms633576(v=vs.85).aspx">WNDCLASS</a>
      pour faire son job.
    </p>
    <p>
      Donc, pour initialiser une variable WNDCLASS, et initialiser tous ces
      champs à 0:
    </p>
    <pre class="prettyprint lang-cpp">
      WNDCLASS WindowClass = {0};
    </pre>
    <p>
      <a href="https://msdn.microsoft.com/fr-fr/library/windows/desktop/ff729176(v=vs.85).aspx">Window Class Styles</a>
    </p>
    <pre class="prettyprint lang-cpp">
      //TODO(doc): check if CS_OWNDC|CS_HREDRAW|CS_VREDRAW still matter
      WindowClass.style = CS_OWNDC|CS_HREDRAW|CS_VREDRAW;
    </pre>
    <p>
      Le champs "lpfnWndProc" sera abordé dans la prochaine section.
    </p>
    <pre class="prettyprint lang-cpp">
      WindowClass.lpfnWndProc = ;
    </pre>
    <p>
      Pour notre programme nous n'avons par besoin
      de réserver plus de mémoire pour la WNDCLASS (cbClsExtra & cbWndExtra).
    </p>
    <p>
      On va commencer par les champs qu'on connais: le champs hInstance.<br/>
      L'instance de notre programme nous ai passé dans notre WinMain
    </p>
    <pre class="prettyprint lang-cpp">
      WindowClass.hInstance = Instance;
    </pre>
    <p>
      Il est toujours possible de récupérer l'instance de son programme de
      n'importe où avec
      <a href="https://msdn.microsoft.com/fr-fr/library/windows/desktop/ms683199(v=vs.85).aspx">GetModuleHndle(0);</a>
    </p>
    <p>
      Pour notre programme nous n'avons par besoin (pour l'instant) de
      définir une icone (hIcon), un curseur (hCursor), ni même
      de définir une couleur de fond pour notre fenétre (hbrBackground).
    </p>
    <p>
      Nous n'aurons pas non plus de "Menu" (Fichiers, Edition, ...)
      (lpszMenuName).
    </p>
    <pre class="prettyprint lang-cpp">
      WindowClass.lpszClassName = "RainbowCreatorWindowClass";
    </pre>
    <P>
      On se retrouve au final avec:
    </p>
    <pre class="prettyprint lang-cpp">
      WNDCLASS WindowClass = {0};
      WindowClass.style = CS_OWNDC|CS_HREDRAW|CS_VREDRAW;
      WindowClass.lpfnWndProc = ; //TODO(doc): explain what to add here
      WindowClass.hInstance = Instance;
      //NOTE(doc): not PJ's window class name
      WindowClass.lpszClassName = "RainbowCreatorWindowClass";
    </pre>
</article>

<article id="a1">
<h1>CALLBACK WindowProc: Il vous manque des papiers</h1>
    <p>
      "Window Procedure" est une fonction qui
      va recevoir tous les messages venant de windows.<br/>
      <a href="https://msdn.microsoft.com/fr-fr/library/windows/desktop/ms633573(v=vs.85).aspx">WindowProc</a>
    </p>
    <p>
      Cette documentation définit la signature de la fonction:
      le nom de la fonction et le nom des paramétres ne sont pas important
      pour former un WindowProc valide.<br/>
      On va donc rajouter sa définition:
    </p>
    <pre class="prettyprint lang-cpp">
      LRESULT CALLBACK
      MainWindowCallback(HWND Window,
          UINT   Message,
          WPARAM WParam,
          LPARAM LParam)
      {
          //TODO(doc): add smoething here;
      }
    </pre>
    <p>
      Et nous pouvons compléter lpfnWndProc.
    </p>
    <pre class="prettyprint lang-cpp">
      WNDCLASS WindowClass = {0};
      WindowClass.style = CS_OWNDC|CS_HREDRAW|CS_VREDRAW;
      WindowClass.lpfnWndProc = MainWindowCallback;
      WindowClass.hInstance = Instance;
      WindowClass.lpszClassName = "RainbowCreatorWindowClass";
    </pre>
    <p>
      MainWindowCallback doit répondre aux messages que windows lui evoi
      pour que tout se passe bien et que windows sache que note fenétre
      est toujours active / [répond aux action de l'utilisateur] /
      [n'ai pas freezé].<br/>
      <a href="https://msdn.microsoft.com/fr-fr/library/windows/desktop/ms644927(v=vs.85).aspx#system_defined">Liste de tous les messages systeme existant</a>
    </p>
    <p>
      Les messages qui nous intéraissent là, tout de suite sont les
      <a href="https://msdn.microsoft.com/fr-fr/library/windows/desktop/ff468922(v=vs.85).aspx">Window Notifications</a>.
      
    </p>
    <pre class="prettyprint lang-cpp">
      LRESULT CALLBACK
      MainWindowCallback(HWND Window,
          UINT   Message,
          WPARAM WParam,
          LPARAM LParam)
      {
      switch(Message){
      case WM_SIZE:{

      }break;
      //NOTE(doc): when windows "destroy" our window
      case WM_DESTROY:{

      }break;
      //NOTE(doc): when the user click on the little red "X"
      case WM_CLOSE:{

      }break;
      //NOTE(doc): when our windows gain or loses focus
      case WM_ACTIVATEAPP:{

      }break;
      default:{
      DefWindowProc(Window, Message, WParam, LParam);
      }break;
      }
      }
    </pre>
</article>

	</div>


<div id="sound_btn">
	<img src="../img/speaker.svg" id="svg_song" class="invisible">
	<img src="../img/mute.svg" id="svg_mute">
</div>

<script type="text/javascript" src="../js/script_song.js"></script>
</body>
</html>
